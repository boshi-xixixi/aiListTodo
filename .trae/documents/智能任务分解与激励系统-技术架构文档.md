# ä»»åŠ¡æ‹†è§£å°åŠ©æ‰‹ - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## 1. æ¶æ„è®¾è®¡

```mermaid
graph TD
    A[ç”¨æˆ·æµè§ˆå™¨] --> B[Reactå‰ç«¯åº”ç”¨]
    B --> C[è±†åŒ…å¤§æ¨¡å‹API]
    B --> D[æµè§ˆå™¨æœ¬åœ°å­˜å‚¨]
    B --> E[Chart.jså›¾è¡¨åº“]
    
    subgraph "å‰ç«¯å±‚"
        B
        E
    end
    
    subgraph "æ•°æ®å­˜å‚¨å±‚"
        D
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        C
    end
```

## 2. æŠ€æœ¯æè¿°

* å‰ç«¯ï¼šReact\@18 + TypeScript + Tailwind CSS + Vite

* å›¾è¡¨åº“ï¼šChart.js\@4 + React-Chartjs-2

* åŠ¨ç”»åº“ï¼šFramer Motion\@10

* å­˜å‚¨ï¼šæµè§ˆå™¨ LocalStorage + IndexedDB

* AIæœåŠ¡ï¼šè±†åŒ…å¤§æ¨¡å‹API (doubao-1-5-lite-32k-250115)

## 3. è·¯ç”±å®šä¹‰

| è·¯ç”±               | ç”¨é€”                 |
| ---------------- | ------------------ |
| /                | é¦–é¡µï¼Œä»»åŠ¡è¾“å…¥å’Œåˆ†è§£åŠŸèƒ½       |
| /execute/:taskId | ä»»åŠ¡æ‰§è¡Œé¡µé¢ï¼Œæ˜¾ç¤ºæ­¥éª¤åˆ—è¡¨å’Œå®ŒæˆçŠ¶æ€ |
| /statistics      | æ•°æ®ç»Ÿè®¡é¡µé¢ï¼Œå±•ç¤ºä»»åŠ¡å®Œæˆæƒ…å†µå’Œå›¾è¡¨ |
| /settings        | è®¾ç½®é¡µé¢ï¼Œä¸ªäººåå¥½å’Œç³»ç»Ÿé…ç½®     |

## 4. APIå®šä¹‰

### 4.1 è±†åŒ…å¤§æ¨¡å‹APIé›†æˆ

ä»»åŠ¡åˆ†è§£APIè°ƒç”¨

```
POST https://ark.cn-beijing.volces.com/api/v3/chat/completions
```

è¯·æ±‚å‚æ•°ï¼š

| å‚æ•°åç§°        | å‚æ•°ç±»å‹      | æ˜¯å¦å¿…éœ€  | æè¿°                              |
| ----------- | --------- | ----- | ------------------------------- |
| model       | string    | true  | æ¨¡å‹åç§°ï¼šdoubao-1-5-lite-32k-250115 |
| messages    | object\[] | true  | å¯¹è¯æ¶ˆæ¯åˆ—è¡¨                          |
| temperature | number    | false | ç”Ÿæˆéšæœºæ€§æ§åˆ¶ï¼Œé»˜è®¤0.7                   |
| max\_tokens | number    | false | æœ€å¤§ç”Ÿæˆtokenæ•°ï¼Œé»˜è®¤1000               |

å“åº”å‚æ•°ï¼š

| å‚æ•°åç§°                        | å‚æ•°ç±»å‹      | æè¿°          |
| --------------------------- | --------- | ----------- |
| choices                     | object\[] | ç”Ÿæˆçš„å›å¤é€‰é¡¹     |
| choices\[0].message.content | string    | AIç”Ÿæˆçš„ä»»åŠ¡åˆ†è§£ç»“æœ |
| usage                       | object    | tokenä½¿ç”¨æƒ…å†µç»Ÿè®¡ |

è¯·æ±‚ç¤ºä¾‹ï¼š

```json
{
  "model": "doubao-1-5-lite-32k-250115",
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»»åŠ¡åˆ†è§£åŠ©æ‰‹ï¼Œè¯·å°†ç”¨æˆ·çš„å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå…·ä½“å¯æ‰§è¡Œçš„æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½è¦é…ä¸Šç§¯æé¼“åŠ±çš„è¯è¯­ã€‚"
    },
    {
      "role": "user",
      "content": "æˆ‘ç°åœ¨åœ¨å®¶é‡Œçœ‹ç”µå½±ï¼Œç­‰ä¼šè¦å»å›¾ä¹¦é¦†å­¦ä¹ "
    }
  ],
  "temperature": 0.7,
  "max_tokens": 1000
}
```

### 4.2 æœ¬åœ°APIæ¥å£è®¾è®¡

ä»»åŠ¡ç®¡ç†ç›¸å…³æ¥å£ï¼ˆåŸºäºLocalStorageå®ç°ï¼‰ï¼š

```typescript
// ä»»åŠ¡æ•°æ®ç±»å‹å®šä¹‰
interface Task {
  id: string;
  title: string;
  description: string;
  steps: TaskStep[];
  status: 'pending' | 'in_progress' | 'completed';
  createdAt: Date;
  completedAt?: Date;
}

interface TaskStep {
  id: string;
  content: string;
  encouragement: string;
  completed: boolean;
  completedAt?: Date;
}

// ç»Ÿè®¡æ•°æ®ç±»å‹
interface TaskStatistics {
  totalTasks: number;
  completedTasks: number;
  completionRate: number;
  averageStepsPerTask: number;
  dailyCompletions: Record<string, number>;
}
```

## 5. æ•°æ®æ¨¡å‹

### 5.1 æ•°æ®æ¨¡å‹å®šä¹‰

```mermaid
erDiagram
    TASK ||--o{ TASK_STEP : contains
    TASK ||--o{ TASK_COMPLETION_LOG : generates
    
    TASK {
        string id PK
        string title
        string description
        string status
        datetime created_at
        datetime completed_at
    }
    
    TASK_STEP {
        string id PK
        string task_id FK
        string content
        string encouragement
        boolean completed
        datetime completed_at
        int step_order
    }
    
    TASK_COMPLETION_LOG {
        string id PK
        string task_id FK
        datetime completion_date
        int total_steps
        int completed_steps
        int duration_minutes
    }
```

### 5.2 æœ¬åœ°å­˜å‚¨æ•°æ®ç»“æ„

åŸºäºæµè§ˆå™¨LocalStorageçš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼š

```typescript
// ä¸»è¦æ•°æ®å­˜å‚¨é”®å
const STORAGE_KEYS = {
  TASKS: 'ai_todo_tasks',
  SETTINGS: 'ai_todo_settings',
  STATISTICS: 'ai_todo_statistics',
  COMPLETION_LOGS: 'ai_todo_completion_logs'
};

// ä»»åŠ¡æ•°æ®å­˜å‚¨
interface TaskStorage {
  tasks: Task[];
  lastUpdated: Date;
}

// ç”¨æˆ·è®¾ç½®å­˜å‚¨
interface SettingsStorage {
  theme: 'light' | 'dark';
  notifications: boolean;
  autoSave: boolean;
  celebrationEffects: boolean;
  apiKey?: string;
}

// ç»Ÿè®¡æ•°æ®å­˜å‚¨
interface StatisticsStorage {
  dailyStats: Record<string, {
    tasksCreated: number;
    tasksCompleted: number;
    stepsCompleted: number;
    totalTimeSpent: number;
  }>;
  weeklyStats: Record<string, {
    completionRate: number;
    averageTasksPerDay: number;
  }>;
  monthlyStats: Record<string, {
    totalTasks: number;
    completionTrend: number[];
  }>;
}

// å®Œæˆè®°å½•å­˜å‚¨
interface CompletionLogStorage {
  logs: {
    id: string;
    taskId: string;
    completedAt: Date;
    duration: number;
    stepsCount: number;
    celebrationTriggered: boolean;
  }[];
}
```

## 6. æ ¸å¿ƒåŠŸèƒ½å®ç°æ–¹æ¡ˆ

### 6.1 AIä»»åŠ¡åˆ†è§£å®ç°

```typescript
// AIä»»åŠ¡åˆ†è§£æœåŠ¡
class TaskDecompositionService {
  private apiKey = 'ee2322b1-8cb8-4c9d-8eb8-00e4dbc19487';
  private apiUrl = 'https://ark.cn-beijing.volces.com/api/v3/chat/completions';
  
  async decomposeTask(userInput: string): Promise<TaskStep[]> {
    const response = await fetch(this.apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.apiKey}`
      },
      body: JSON.stringify({
        model: 'doubao-1-5-lite-32k-250115',
        messages: [
          {
            role: 'system',
            content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»»åŠ¡åˆ†è§£åŠ©æ‰‹ï¼Œè¯·å°†ç”¨æˆ·çš„å¤æ‚ä»»åŠ¡åˆ†è§£ä¸º3-8ä¸ªå…·ä½“å¯æ‰§è¡Œçš„æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½è¦é…ä¸Šç§¯æé¼“åŠ±çš„è¯è¯­ã€‚è¿”å›JSONæ ¼å¼ï¼š{"steps": [{"content": "æ­¥éª¤å†…å®¹", "encouragement": "é¼“åŠ±è¯è¯­"}]}'
          },
          {
            role: 'user',
            content: userInput
          }
        ],
        temperature: 0.7,
        max_tokens: 1000
      })
    });
    
    const data = await response.json();
    return this.parseAIResponse(data.choices[0].message.content);
  }
}
```

### 6.2 åº†ç¥åŠ¨æ•ˆå®ç°

```typescript
// åº†ç¥åŠ¨æ•ˆç»„ä»¶
const CelebrationEffect: React.FC = () => {
  return (
    <motion.div
      initial={{ scale: 0, opacity: 0 }}
      animate={{ scale: 1, opacity: 1 }}
      exit={{ scale: 0, opacity: 0 }}
      className="celebration-container"
    >
      <Confetti
        width={window.innerWidth}
        height={window.innerHeight}
        recycle={false}
        numberOfPieces={200}
        colors={['#FF6B35', '#4ECDC4', '#45B7D1', '#96CEB4']}
      />
      <motion.div
        initial={{ y: 50 }}
        animate={{ y: 0 }}
        className="celebration-message"
      >
        ğŸ‰ å¤ªæ£’äº†ï¼åˆå®Œæˆäº†ä¸€ä¸ªæ­¥éª¤ï¼
      </motion.div>
    </motion.div>
  );
};
```

### 6.3 æ•°æ®å¯è§†åŒ–å®ç°

```typescript
// ç»Ÿè®¡å›¾è¡¨ç»„ä»¶
const StatisticsChart: React.FC = () => {
  const chartData = {
    labels: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
    datasets: [
      {
        label: 'å®Œæˆä»»åŠ¡æ•°',
        data: [3, 5, 2, 8, 4, 6, 7],
        backgroundColor: 'rgba(255, 107, 53, 0.6)',
        borderColor: '#FF6B35',
        borderWidth: 2
      }
    ]
  };
  
  return (
    <div className="chart-container">
      <Bar data={chartData} options={{
        responsive: true,
        plugins: {
          legend: {
            position: 'top' as const,
          },
          title: {
            display: true,
            text: 'æœ¬å‘¨ä»»åŠ¡å®Œæˆæƒ…å†µ'
          }
        }
      }} />
    </div>
  );
};
```

